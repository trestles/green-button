<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Pvimpact-greenbutton</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.9.0/application.js' type='text/javascript'></script>    
    <link href='./assets/0.9.0/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="./assets/0.9.0/favicon_green.png" />
    <link rel="icon" type="image/png" href="./assets/0.9.0/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.9.0/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2015-04-07T12:15:41+08:00">2015-04-07T12:15:41+08:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="green">97.4%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         1105.34
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>16</b> files in total.
    <b>578</b> relevant lines. 
    <span class="green"><b>563</b> lines covered</span> and
    <span class="red"><b>15</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#340e54b8f946e4fd2c3d6eb80a61bf180fccefbb" class="src_link" title="lib/pvimpact-greenbutton.rb">lib/pvimpact-greenbutton.rb</a></td>
        <td class="green strong">92.16 %</td>
        <td>211</td>
        <td>102</td>
        <td>94</td>
        <td>8</td>
        <td>9.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8809a02cd3f799b641eac4637860849e2f52d349" class="src_link" title="lib/pvimpact/greenbutton/aggregator.rb">lib/pvimpact/greenbutton/aggregator.rb</a></td>
        <td class="green strong">95.0 %</td>
        <td>157</td>
        <td>60</td>
        <td>57</td>
        <td>3</td>
        <td>6862.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#31fcad084003d81edc58f3da63faed94ed4d465a" class="src_link" title="lib/pvimpact/greenbutton/errors.rb">lib/pvimpact/greenbutton/errors.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e78258f9f591841a5ccf7226012d078595ec49b8" class="src_link" title="lib/pvimpact/greenbutton/model/aggregation_type.rb">lib/pvimpact/greenbutton/model/aggregation_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>26</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#57c827481199e7cfdb77b382c333e011c815f928" class="src_link" title="lib/pvimpact/greenbutton/model/electricity_power_usage_summary.rb">lib/pvimpact/greenbutton/model/electricity_power_usage_summary.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>62</td>
        <td>21</td>
        <td>21</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#70d0188f23422ef346d7d44bf4e991ea8224a330" class="src_link" title="lib/pvimpact/greenbutton/model/interval_block.rb">lib/pvimpact/greenbutton/model/interval_block.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>29</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8861c6c258aba7b67b3339845b8e453b336fc5a2" class="src_link" title="lib/pvimpact/greenbutton/model/interval_reading.rb">lib/pvimpact/greenbutton/model/interval_reading.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>35</td>
        <td>12</td>
        <td>12</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8ad349d69314727cd511928e86e59065c9ff87f7" class="src_link" title="lib/pvimpact/greenbutton/model/local_time_parameters.rb">lib/pvimpact/greenbutton/model/local_time_parameters.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>28</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5239ce03b6fbbd5483726b2abbaa349e41ce26b5" class="src_link" title="lib/pvimpact/greenbutton/model/meter_reading.rb">lib/pvimpact/greenbutton/model/meter_reading.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>22</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6101aa9d2d1584317189ef318d7363fd440fa26b" class="src_link" title="lib/pvimpact/greenbutton/model/meter_reading_type.rb">lib/pvimpact/greenbutton/model/meter_reading_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>52</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b286aea2e53259713892057b5db42e1d6e64e807" class="src_link" title="lib/pvimpact/greenbutton/model/usage_point.rb">lib/pvimpact/greenbutton/model/usage_point.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>28</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#251276858dfbc288f9ba0a165c52484fdefc57ff" class="src_link" title="lib/pvimpact/greenbutton/parser.rb">lib/pvimpact/greenbutton/parser.rb</a></td>
        <td class="green strong">90.91 %</td>
        <td>190</td>
        <td>44</td>
        <td>40</td>
        <td>4</td>
        <td>928.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5f9ab964bf7d09256be8cfabbbdf8b2df0b9d411" class="src_link" title="lib/pvimpact/greenbutton/validation.rb">lib/pvimpact/greenbutton/validation.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>55</td>
        <td>16</td>
        <td>16</td>
        <td>0</td>
        <td>46.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7732073ad0e7f82830db2d9af3c795301b3a9de1" class="src_link" title="lib/pvimpact/greenbutton/version.rb">lib/pvimpact/greenbutton/version.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#88122358ed02c7d6f15a7dd79372ef3bdb5b470e" class="src_link" title="spec/pvimpact/greenbutton/aggregator_spec.rb">spec/pvimpact/greenbutton/aggregator_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>253</td>
        <td>162</td>
        <td>162</td>
        <td>0</td>
        <td>1099.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#19eb1ceffa89831d57b0e0880f0501e4a2a32d26" class="src_link" title="spec/pvimpact/greenbutton/parser_spec.rb">spec/pvimpact/greenbutton/parser_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>145</td>
        <td>92</td>
        <td>92</td>
        <td>0</td>
        <td>68.6</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.9.2 
        and simplecov-html v0.9.0<br/>
        using RSpec
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="340e54b8f946e4fd2c3d6eb80a61bf180fccefbb">
  <div class="header">
    <h3>lib/pvimpact-greenbutton.rb</h3>
    <h4><span class="green">92.16 %</span> covered</h4>
    <div>
      <b>102</b> relevant lines. 
      <span class="green"><b>94</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;tempfile&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;logger&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;greenbutton&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;faraday&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;data_mapper&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;dm-migrations&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;configurations&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pvimpact/greenbutton/version&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pvimpact/greenbutton/validation&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pvimpact/greenbutton/model/electricity_power_usage_summary&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pvimpact/greenbutton/model/interval_block&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pvimpact/greenbutton/model/interval_reading&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pvimpact/greenbutton/model/local_time_parameters&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pvimpact/greenbutton/model/meter_reading&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pvimpact/greenbutton/model/meter_reading_type&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pvimpact/greenbutton/model/usage_point&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pvimpact/greenbutton/model/aggregation_type&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pvimpact/greenbutton/errors&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pvimpact/greenbutton/parser&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pvimpact/greenbutton/aggregator&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">module PVImpactGreenButton</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  extend PVImpactGreenButton::Validation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  include Configurations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  # This is the shared logger.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  LOGGER = Logger.new(&#39;greenbutton.log&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  # This is the configuration option for DB URL, default to &#39;postgres://localhost/pvimpact_greenbutton&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  configurable String, :db_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  # Configure default options.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  configuration_defaults do |c|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    c.db_url = &#39;postgres://localhost/pvimpact_greenbutton&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  # Public: Setup database for this gem.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  # Raises PVImpactGreenButton::PersistenceError if failed to setup database</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.setup_db</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">      DataMapper.setup(:default, PVImpactGreenButton.configuration.db_url)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">      DataMapper::Model.raise_on_save_failure = true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">      DataMapper.finalize</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">    rescue =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">      LOGGER.fatal(e.backtrace)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">      raise PVImpactGreenButton::PersistenceError, e.message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  # Public: Create database tables for this gem. NOTE that this method will wipe and re-create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  # the database tables.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  # Raises PVImpactGreenButton::PersistenceError if failed to setup database</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.create_db</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">    setup_db</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">    DataMapper.auto_migrate!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  # Public: Download customer GreenButton data from GreenButton API, apply aggregation if needed and then save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  # the data into database persistence.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  # access_token - the OAuth2 access token String used to access the GreenButton API</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  # resource_uri - the URI String of the resource to download</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  # interval_start_time - the interval start Time, optional</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">  # interval_end_time - the interval end Time, optional</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">  # aggregation_type - the AggregationType, optional</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">  # Returns the downloaded UsagePoint data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  # Raises ArgumentError if access_token/resource_uri is nil or blank string or does not respond to to_s, or</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  # interval_start_time/interval_end_time is not Time, or interval_start_time is later than interval_end_time,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  # or aggregation_type is not AggregationType</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">  # Raises PVImpactGreenButton::UnsupportedServiceKindError if any of the UsagePoint is for unsupported</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">  # service kind (currently only 0 - electricity is supported).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  # Raises PVImpactGreenButton::ParsingError if failed to parse the GreenButton data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  # Raises PVImpactGreenButton::AggregationError if failed to aggregate the GreenButton data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  # Raises PVImpactGreenButton::PersistenceError if failed to save GreenButton data into persistence</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.download_data(access_token, resource_uri, interval_start_time = nil, interval_end_time = nil, aggregation_type = nil)</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="84">
          <span class="hits">27</span>
          
          <code class="ruby">    validate_string(access_token, &#39;access_token&#39;)</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="85">
          <span class="hits">25</span>
          
          <code class="ruby">    validate_string(resource_uri, &#39;resource_uri&#39;)</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="86">
          <span class="hits">23</span>
          
          <code class="ruby">    validate_time(interval_start_time, &#39;interval_start_time&#39;, false)</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="87">
          <span class="hits">22</span>
          
          <code class="ruby">    validate_time(interval_end_time, &#39;interval_end_time&#39;, false)</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="88">
          <span class="hits">21</span>
          
          <code class="ruby">    validate_time_range(interval_start_time, &#39;interval_start_time&#39;, interval_end_time, &#39;interval_end_time&#39;) if interval_start_time &amp;&amp; interval_end_time</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="89">
          <span class="hits">20</span>
          
          <code class="ruby">    validate_aggregation_type(aggregation_type, &#39;aggregation_type&#39;) if aggregation_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="91">
          <span class="hits">19</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="92">
          <span class="hits">19</span>
          
          <code class="ruby">      LOGGER.info(&quot;Send request to URL #{resource_uri}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">      # Fetch data from resource URI</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="94">
          <span class="hits">19</span>
          
          <code class="ruby">      conn = Faraday.new(:url =&gt; resource_uri, :headers =&gt; { &#39;Authorization&#39; =&gt; &quot;Bearer #{access_token}&quot;})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">      # Apply date filters only if the resource has been downloaded before, discussions:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">      # http://apps.topcoder.com/forums/?module=Thread&amp;threadID=850470&amp;start=0</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="98">
          <span class="hits">18</span>
          
          <code class="ruby">      if UsagePoint.count(:subscription_id =&gt; resource_uri) &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="99">
          <span class="hits">2</span>
          
          <code class="ruby">        conn.params[&#39;published-min&#39;] = interval_start_time.utc.iso8601 if interval_start_time</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="100">
          <span class="hits">2</span>
          
          <code class="ruby">        conn.params[&#39;published-max&#39;] = interval_end_time.utc.iso8601 if interval_end_time</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="101">
          <span class="hits">2</span>
          
          <code class="ruby">        LOGGER.info(&quot;Using published-min #{conn.params[&#39;published-min&#39;]}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="102">
          <span class="hits">2</span>
          
          <code class="ruby">        LOGGER.info(&quot;Using published-max #{conn.params[&#39;published-max&#39;]}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="105">
          <span class="hits">18</span>
          
          <code class="ruby">      response = conn.get</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="106">
          <span class="hits">18</span>
          
          <code class="ruby">      raise PVImpactGreenButton::GreenButtonError, &quot;GreenButton API responded with error code #{response.status}.&quot; unless response.status == 200</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">      # Create temporary file</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="109">
          <span class="hits">17</span>
          
          <code class="ruby">      tempfile = Tempfile.new(&#39;download_data&#39;)</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="110">
          <span class="hits">17</span>
          
          <code class="ruby">      LOGGER.info(&quot;Received GreenButton response #{response.body}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">      # Write response to temp file</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="112">
          <span class="hits">17</span>
          
          <code class="ruby">      tempfile.write(response.body)</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="113">
          <span class="hits">17</span>
          
          <code class="ruby">      tempfile.close</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">    rescue PVImpactGreenButton::GreenButtonError =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">      raise e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">    rescue =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">      LOGGER.fatal(e.backtrace)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">      raise PVImpactGreenButton::GreenButtonError, e.message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="121">
          <span class="hits">17</span>
          
          <code class="ruby">    usage_points = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">    # Begin transaction</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="123">
          <span class="hits">17</span>
          
          <code class="ruby">    UsagePoint.transaction do |txn|</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="124">
          <span class="hits">17</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">        # Parse response</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="126">
          <span class="hits">17</span>
          
          <code class="ruby">        parser = Parser.new()</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="127">
          <span class="hits">17</span>
          
          <code class="ruby">        parser.parse(tempfile.path, resource_uri)</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="128">
          <span class="hits">17</span>
          
          <code class="ruby">        usage_points = parser.usage_points</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="130">
          <span class="hits">17</span>
          
          <code class="ruby">        if usage_points.length == 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">          # Retrieve and update IntervalBlock&#39;s</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">          parser.interval_blocks.each do |interval_block|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">            interval_block.save()</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">          # Query from local persistence</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">          usage_points = retrieve_data(resource_uri, interval_start_time, interval_end_time, aggregation_type)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">          # For each usage point, perform aggregation and save in persistence</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="140">
          <span class="hits">16</span>
          
          <code class="ruby">          usage_points.each do |usage_point|</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="141">
          <span class="hits">16</span>
          
          <code class="ruby">            usage_point = Aggregator.aggregate(usage_point, aggregation_type)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="142">
          <span class="hits">16</span>
          
          <code class="ruby">            usage_point.meter_readings.each do |meter_reading|</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="143">
          <span class="hits">16</span>
          
          <code class="ruby">              meter_reading.interval_blocks.each do |interval_block|</code>
        </li>
      
        <li class="covered" data-hits="240" data-linenumber="144">
          <span class="hits">240</span>
          
          <code class="ruby">                interval_block.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="146">
          <span class="hits">16</span>
          
          <code class="ruby">              meter_reading.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="148">
          <span class="hits">16</span>
          
          <code class="ruby">            usage_point.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">      rescue DataMapper::SaveFailureError =&gt; e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">        # Rollback transaction and raise PersistenceError</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="153">
          
          
          <code class="ruby">        LOGGER.fatal(e.backtrace)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="154">
          
          
          <code class="ruby">        txn.rollback</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="155">
          
          
          <code class="ruby">        raise PVImpactGreenButton::PersistenceError, e.resource.errors.inspect</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">      ensure</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">        # Remove temp file</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="158">
          <span class="hits">17</span>
          
          <code class="ruby">        tempfile.unlink</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="161">
          <span class="hits">17</span>
          
          <code class="ruby">    return usage_points</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">  # Public: Retrieve customer GreenButton data from database persistence, and apply aggregation if needed.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">  # subscription_id - the subscription ID String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">  # interval_start_time - the interval start Time, optional</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">  # interval_end_time - the interval end Time, optional</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">  # aggregation_type - the AggregationType, optional</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">  # Returns the persisted UsagePoint data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">  # Raises ArgumentError if subscription_id is nil or blank string or does not respond to to_s, or</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">  # interval_start_time/interval_end_time is not Time, or interval_start_time is later than interval_end_time,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">  # or aggregation_type is not AggregationType</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">  # Raises PVImpactGreenButton::AggregationError if failed to aggregate the GreenButton data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">  # Raises PVImpactGreenButton::PersistenceError if failed to save GreenButton data into persistence</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.retrieve_data(subscription_id, interval_start_time = nil, interval_end_time = nil, aggregation_type = nil)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="179">
          <span class="hits">15</span>
          
          <code class="ruby">    validate_string(subscription_id, &#39;subscription_id&#39;)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="180">
          <span class="hits">13</span>
          
          <code class="ruby">    validate_time(interval_start_time, &#39;interval_start_time&#39;, false)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="181">
          <span class="hits">12</span>
          
          <code class="ruby">    validate_time(interval_end_time, &#39;interval_end_time&#39;, false)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="182">
          <span class="hits">11</span>
          
          <code class="ruby">    validate_time_range(interval_start_time, &#39;interval_start_time&#39;, interval_end_time, &#39;interval_end_time&#39;) if interval_start_time &amp;&amp; interval_end_time</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="183">
          <span class="hits">10</span>
          
          <code class="ruby">    validate_aggregation_type(aggregation_type, &#39;aggregation_type&#39;) if aggregation_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="185">
          <span class="hits">9</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">      # Query usage points from persistence</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="187">
          <span class="hits">9</span>
          
          <code class="ruby">      interval_block_filter = {}</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="188">
          <span class="hits">9</span>
          
          <code class="ruby">      interval_block_filter = interval_block_filter.merge({ :start_time.gte =&gt; interval_start_time }) if interval_start_time</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="189">
          <span class="hits">9</span>
          
          <code class="ruby">      interval_block_filter = interval_block_filter.merge({ :end_time.lte =&gt; interval_end_time }) if interval_end_time</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="190">
          <span class="hits">9</span>
          
          <code class="ruby">      usage_points = UsagePoint.all(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">        :subscription_id =&gt; subscription_id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">        :meter_readings =&gt; {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">          :interval_blocks =&gt; interval_block_filter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">      # For each usage point, perform aggregation</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="197">
          <span class="hits">9</span>
          
          <code class="ruby">      usage_points.each do |usage_point|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="198">
          <span class="hits">9</span>
          
          <code class="ruby">        Aggregator.aggregate(usage_point, aggregation_type)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="200">
          <span class="hits">9</span>
          
          <code class="ruby">        usage_point.meter_readings.each do |meter_reading|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">          # Include only IntervalBlock&#39;s within the range</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="202">
          <span class="hits">9</span>
          
          <code class="ruby">          meter_reading.interval_blocks = meter_reading.interval_blocks.all(interval_block_filter)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="206">
          <span class="hits">9</span>
          
          <code class="ruby">      return usage_points</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="207">
          
          
          <code class="ruby">    rescue DataMapper::PersistenceError, DataMapper::ObjectNotFoundError, DataMapper::UnknownRelationshipError =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="208">
          
          
          <code class="ruby">      raise PVImpactGreenButton::PersistenceError, e.message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8809a02cd3f799b641eac4637860849e2f52d349">
  <div class="header">
    <h3>lib/pvimpact/greenbutton/aggregator.rb</h3>
    <h4><span class="green">95.0 %</span> covered</h4>
    <div>
      <b>60</b> relevant lines. 
      <span class="green"><b>57</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">module PVImpactGreenButton</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # Public: This module provides method to aggregate interval readings in a UsagePoint according</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  # to given aggregation type.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  module Aggregator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    extend Validation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    # Public: Aggregates interval readings in a UsagePoint according to given aggregation type.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    # usage_point - the UsagePoint to aggregate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    # aggregation_type - the AggregationType used to apply aggregation.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    # Returns the aggregated UsagePoint</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    # Raises ArgumentError if usage_point is nil, or aggregation_type is not of type AggregationType</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # Raises PVImpactGreenButton::AggregationError if any error occurred during the aggregation process</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.aggregate(usage_point, aggregation_type = nil)</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="21">
          <span class="hits">34</span>
          
          <code class="ruby">      validate_required(usage_point, &#39;usage_point&#39;)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="22">
          <span class="hits">33</span>
          
          <code class="ruby">      validate_aggregation_type(aggregation_type, &#39;aggregation_type&#39;) if aggregation_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      # No further aggregation is required</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="25">
          <span class="hits">32</span>
          
          <code class="ruby">      return usage_point if !aggregation_type || aggregation_type == AggregationType::DEFAULT</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      # Iterate through all MeterReading&#39;s of the UsagePoint</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="28">
          <span class="hits">10</span>
          
          <code class="ruby">      usage_point.meter_readings.each do |meter_reading|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">        # Raise error if time_attribute isn&#39;t supported</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="30">
          <span class="hits">10</span>
          
          <code class="ruby">        raise PVImpactGreenButton::AggregationError unless meter_reading.meter_reading_type.time_attribute.between?(0, 77)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="32">
          <span class="hits">10</span>
          
          <code class="ruby">        interval_length = meter_reading.meter_reading_type.aggregation_type == 0 ?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">          meter_reading.meter_reading_type.interval_length : meter_reading.meter_reading_type.aggregation_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">        # (Validation)Iterate through all IntervalBlock&#39;s of the MeterReading</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="36">
          <span class="hits">10</span>
          
          <code class="ruby">        meter_reading.interval_blocks.each do |interval_block|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">          # Iterate through all IntervalReading&#39;s of the IntervalBlock</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="38">
          <span class="hits">136</span>
          
          <code class="ruby">          interval_block.interval_readings.each do |interval_reading|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">            # Validate missing/zero/NaN value/cost and mark as is_missing if needed</code>
        </li>
      
        <li class="covered" data-hits="4020" data-linenumber="40">
          <span class="hits">4020</span>
          
          <code class="ruby">            interval_reading.value = nil if interval_reading.value == 0</code>
        </li>
      
        <li class="covered" data-hits="4020" data-linenumber="41">
          <span class="hits">4020</span>
          
          <code class="ruby">            interval_reading.cost = nil if interval_reading.cost == 0</code>
        </li>
      
        <li class="covered" data-hits="4020" data-linenumber="42">
          <span class="hits">4020</span>
          
          <code class="ruby">            interval_reading.is_missing = true if !interval_reading.value || !interval_reading.cost</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">        # Perform aggregation only if current interval length does not match aggregation type</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="47">
          <span class="hits">10</span>
          
          <code class="ruby">        next unless interval_length != aggregation_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="49">
          <span class="hits">7</span>
          
          <code class="ruby">        meter_reading.meter_reading_type.aggregation_type = aggregation_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="51">
          <span class="hits">7</span>
          
          <code class="ruby">        begin</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="52">
          <span class="hits">7</span>
          
          <code class="ruby">          if aggregation_type &lt; interval_length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">          # target interval is less than current interval length, divide current interval readings</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="54">
          <span class="hits">4</span>
          
          <code class="ruby">          meter_reading.interval_blocks.each do |interval_block|</code>
        </li>
      
        <li class="covered" data-hits="46" data-linenumber="55">
          <span class="hits">46</span>
          
          <code class="ruby">            interval_readings = [].push(*interval_block.interval_readings)</code>
        </li>
      
        <li class="covered" data-hits="46" data-linenumber="56">
          <span class="hits">46</span>
          
          <code class="ruby">            interval_block.interval_readings = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="46" data-linenumber="58">
          <span class="hits">46</span>
          
          <code class="ruby">            interval_readings.each do |interval_reading|</code>
        </li>
      
        <li class="covered" data-hits="1356" data-linenumber="59">
          <span class="hits">1356</span>
          
          <code class="ruby">              start_time = interval_reading.start_time</code>
        </li>
      
        <li class="covered" data-hits="1356" data-linenumber="60">
          <span class="hits">1356</span>
          
          <code class="ruby">              avg_value = interval_reading.is_missing ? nil : interval_reading.value.to_f / interval_length</code>
        </li>
      
        <li class="covered" data-hits="1356" data-linenumber="61">
          <span class="hits">1356</span>
          
          <code class="ruby">              avg_cost = interval_reading.is_missing ? nil : interval_reading.cost.to_f / interval_length</code>
        </li>
      
        <li class="covered" data-hits="1356" data-linenumber="62">
          <span class="hits">1356</span>
          
          <code class="ruby">              (1..interval_length / aggregation_type).each do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">                # Create new IntervalReading</code>
        </li>
      
        <li class="covered" data-hits="127968" data-linenumber="64">
          <span class="hits">127968</span>
          
          <code class="ruby">                end_time = (start_time + aggregation_type).utc</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">                interval_block.interval_readings &lt;&lt; IntervalReading.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">                  {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">                    :aggregation_type =&gt; aggregation_type,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">                    :cost =&gt; avg_cost == nil ? avg_cost : avg_cost * aggregation_type,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">                    :value =&gt; avg_value == nil ? avg_value : avg_value * aggregation_type,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">                    :start_time =&gt; start_time,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">                    :end_time =&gt; end_time,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">                    :is_missing =&gt; interval_reading.is_missing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">                  }</code>
        </li>
      
        <li class="covered" data-hits="127968" data-linenumber="74">
          <span class="hits">127968</span>
          
          <code class="ruby">                )</code>
        </li>
      
        <li class="covered" data-hits="127968" data-linenumber="75">
          <span class="hits">127968</span>
          
          <code class="ruby">                start_time = end_time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1356" data-linenumber="78">
          <span class="hits">1356</span>
          
          <code class="ruby">              reminder = interval_length % aggregation_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">              interval_block.interval_readings &lt;&lt; IntervalReading.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">                {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">                  :aggregation_type =&gt; aggregation_type,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">                  :cost =&gt; avg_cost == nil ? avg_cost : avg_cost * reminder,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">                  :value =&gt; avg_value == nil ? avg_value : avg_value * reminder,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">                  :start_time =&gt; start_time,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">                  :end_time =&gt; (start_time + reminder).utc,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">                  :is_missing =&gt; interval_reading.is_missing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">                }</code>
        </li>
      
        <li class="covered" data-hits="1356" data-linenumber="88">
          <span class="hits">1356</span>
          
          <code class="ruby">              ) if reminder &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">          # target interval is greater than current interval length, aggregate current interval readings</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="94">
          <span class="hits">3</span>
          
          <code class="ruby">          meter_reading.interval_blocks.each do |interval_block|</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="95">
          <span class="hits">45</span>
          
          <code class="ruby">            start_time = nil</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="96">
          <span class="hits">45</span>
          
          <code class="ruby">            total_value = 0</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="97">
          <span class="hits">45</span>
          
          <code class="ruby">            total_cost = 0</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="98">
          <span class="hits">45</span>
          
          <code class="ruby">            total_duration = 0</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="99">
          <span class="hits">45</span>
          
          <code class="ruby">            interval_readings = [].push(*interval_block.interval_readings)</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="100">
          <span class="hits">45</span>
          
          <code class="ruby">            interval_block.interval_readings = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">            # Iterate through all IntervalReading&#39;s of the IntervalBlock</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="103">
          <span class="hits">45</span>
          
          <code class="ruby">            interval_readings.each do |interval_reading|</code>
        </li>
      
        <li class="covered" data-hits="1332" data-linenumber="104">
          <span class="hits">1332</span>
          
          <code class="ruby">              start_time = interval_reading.start_time unless start_time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">              # A new IntervalReading should be created</code>
        </li>
      
        <li class="covered" data-hits="1332" data-linenumber="106">
          <span class="hits">1332</span>
          
          <code class="ruby">              if total_duration + interval_length &gt;= aggregation_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">                # Accumulate part of the reading</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="108">
          <span class="hits">24</span>
          
          <code class="ruby">                ratio = (aggregation_type - total_duration).to_f / interval_length</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="109">
          <span class="hits">24</span>
          
          <code class="ruby">                total_value += ratio * interval_reading.value if interval_reading.value</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="110">
          <span class="hits">24</span>
          
          <code class="ruby">                total_cost += ratio * interval_reading.cost if interval_reading.cost</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="111">
          <span class="hits">24</span>
          
          <code class="ruby">                end_time = (start_time + aggregation_type).utc</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">                # Create new IntervalReading</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">                interval_block.interval_readings &lt;&lt; IntervalReading.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">                  {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">                    :aggregation_type =&gt; aggregation_type,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">                    :cost =&gt; total_cost,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">                    :value =&gt; total_value,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">                    :start_time =&gt; start_time,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">                    :end_time =&gt; end_time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">                  }</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="122">
          <span class="hits">24</span>
          
          <code class="ruby">                )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">                # Reset accumulating variables</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="125">
          <span class="hits">24</span>
          
          <code class="ruby">                total_value = (1 - ratio) * interval_reading.value if interval_reading.value</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="126">
          <span class="hits">24</span>
          
          <code class="ruby">                total_cost = (1 - ratio) * interval_reading.cost if interval_reading.cost</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="127">
          <span class="hits">24</span>
          
          <code class="ruby">                total_duration = (1 - ratio) * interval_length</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="128">
          <span class="hits">24</span>
          
          <code class="ruby">                start_time = end_time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">              else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">                # Continue accumulating</code>
        </li>
      
        <li class="covered" data-hits="1308" data-linenumber="131">
          <span class="hits">1308</span>
          
          <code class="ruby">                total_value += interval_reading.value if interval_reading.value</code>
        </li>
      
        <li class="covered" data-hits="1308" data-linenumber="132">
          <span class="hits">1308</span>
          
          <code class="ruby">                total_cost += interval_reading.cost if interval_reading.cost</code>
        </li>
      
        <li class="covered" data-hits="1308" data-linenumber="133">
          <span class="hits">1308</span>
          
          <code class="ruby">                total_duration += interval_length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">            # We may have still accumulated readings not added</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">            interval_block.interval_readings &lt;&lt; IntervalReading.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">              {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">                :aggregation_type =&gt; aggregation_type,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">                :cost =&gt; total_cost,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">                :value =&gt; total_value,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">                :start_time =&gt; start_time,</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="144">
          <span class="hits">21</span>
          
          <code class="ruby">                :end_time =&gt; (start_time + total_duration).utc</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">              }</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="146">
          <span class="hits">45</span>
          
          <code class="ruby">            ) if total_duration &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">        rescue =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="150">
          
          
          <code class="ruby">          LOGGER.fatal(e.backtrace)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="151">
          
          
          <code class="ruby">          raise PVImpactGreenButton::AggregationError, e.message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="154">
          <span class="hits">10</span>
          
          <code class="ruby">      usage_point</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="31fcad084003d81edc58f3da63faed94ed4d465a">
  <div class="header">
    <h3>lib/pvimpact/greenbutton/errors.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">module PVImpactGreenButton</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # Public: This is the base class for errors raised in this gem.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  class GreenButtonError &lt; StandardError; end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  # Public: This error indicates unsupported service kind.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  class UnsupportedServiceKindError &lt; GreenButtonError; end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  # Public: This error indicates error during parsing GreenButton data.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  class ParsingError &lt; GreenButtonError; end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  # Public: This error indicates error during accessing persistence.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  class PersistenceError &lt; GreenButtonError; end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  # Public: This error indicates error during aggregating data.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  class AggregationError &lt; GreenButtonError; end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e78258f9f591841a5ccf7226012d078595ec49b8">
  <div class="header">
    <h3>lib/pvimpact/greenbutton/model/aggregation_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;ruby-enum&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">module PVImpactGreenButton</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  # Public: This enum represents aggregation type.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  class AggregationType</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    include Ruby::Enum</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    # Public: Aggregation type of interval returned from GreenButton API.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    define :DEFAULT, 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    # Public: Aggregation type of &#39;15 minutes&#39;.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    define :FIFTEEN_MINUTES, 60 * 15</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    # Public: Aggregation type of &#39;1 hour&#39;.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    define :ONE_HOUR, 60 * 60</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    # Public: Aggregation type of &#39;1 day&#39;.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    define :ONE_DAY, 60 * 60 * 24</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    # Public: Aggregation type of &#39;1 month&#39;.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    define :ONE_MONTH, 60 * 60 * 24 * 31</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="57c827481199e7cfdb77b382c333e011c815f928">
  <div class="header">
    <h3>lib/pvimpact/greenbutton/model/electricity_power_usage_summary.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>21</b> relevant lines. 
      <span class="green"><b>21</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;dm-zone-types&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">module PVImpactGreenButton</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  # Public: This class represents Electricity Power Usage Summary.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  class ElectricityPowerUsageSummary</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    include DataMapper::Resource</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    # Public: Returns the String id.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    property :id, Text, :key =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    # Public: Returns the duration.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    property :duration, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    # Public: Returns the start time.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    property :start_time, ZonedTime</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    # Public: Returns the bill last period.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    property :bill_last_period, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    # Public: Returns the bill to date.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    property :bill_to_date, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    # Public: Returns the cost additional last period.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    property :cost_additional_last_period, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    # Public: Returns the currency.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    property :currency, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    # Public: Returns the overall consumption last period power of ten multiplier.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    property :overall_consumption_last_period_power_of_ten_multiplier, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    # Public: Returns the overall consumption last period UOM.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    property :overall_consumption_last_period_uom, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    # Public: Returns the overall consumption last period value.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    property :overall_consumption_last_period_value, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    # Public: Returns the current billing period overall consumption power of ten multiplier.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">    property :current_billing_period_overall_consumption_power_of_ten_multiplier, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    # Public: Returns the current billing period overall consumption UOM.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">    property :current_billing_period_overall_consumption_uom, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    # Public: Returns the current billing period overall consumption timestamp.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">    property :current_billing_period_overall_consumption_timestamp, ZonedTime</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    # Public: Returns the current billing period overall consumption value.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">    property :current_billing_period_overall_consumption_value, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    # Public: Returns the quality of reading.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">    property :quality_of_reading, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    # Public: Returns the status timestamp.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">    property :status_time_stamp, ZonedTime</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    # Public: Returns the UsagePoint.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">    belongs_to :usage_point</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="70d0188f23422ef346d7d44bf4e991ea8224a330">
  <div class="header">
    <h3>lib/pvimpact/greenbutton/model/interval_block.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;dm-zone-types&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">module PVImpactGreenButton</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  # Public: This class represents Interval Block.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  class IntervalBlock</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    include DataMapper::Resource</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    # Public: Returns the String id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    property :id, Text, :key =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    # Public: Returns the start time.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    property :start_time, ZonedTime</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    # Public: Returns the end time.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    property :end_time, ZonedTime</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    # Public: Returns the ID of the UsagePoint</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    property :usage_point_id, Text</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    # Public: Returns the IntervalReading&#39;s.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    has n, :interval_readings, :order =&gt; [ :start_time.asc ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    # Public: Returns the MeterReading.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    belongs_to :meter_reading</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8861c6c258aba7b67b3339845b8e453b336fc5a2">
  <div class="header">
    <h3>lib/pvimpact/greenbutton/model/interval_reading.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;dm-zone-types&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">module PVImpactGreenButton</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  # Public: This class represents Interval Reading.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  class IntervalReading</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    include DataMapper::Resource</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    # Public: Returns the String id.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    property :id, Serial</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    # Public: Returns the aggregation type.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    property :aggregation_type, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    # Public: Returns the cost.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    property :cost, Float</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    # Public: Returns the start time.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    property :start_time, ZonedTime</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    # Public: Returns the end time.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    property :end_time, ZonedTime</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    # Public: Returns the value.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    property :value, Float</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    # Public: Returns the IntervalBlock&#39;s.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    belongs_to :interval_block</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    # Public: Returns whether value is missing for this IntervalReading.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    property :is_missing, Boolean</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8ad349d69314727cd511928e86e59065c9ff87f7">
  <div class="header">
    <h3>lib/pvimpact/greenbutton/model/local_time_parameters.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">module PVImpactGreenButton</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # Public: This class represents Local Time Parameters.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  class LocalTimeParameters</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    include DataMapper::Resource</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    # Public: Returns the String id.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    property :id, Text, :key =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    # Public: Returns the DST end rule.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    property :dst_end_rule, String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    # Public: Returns the DST offset.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    property :dst_offset, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # Public: Returns the DST start rule.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    property :dst_start_rule, String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    # Public: Returns the timezone offset.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    property :tz_offset, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    # Public: Returns the UsagePoint.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    belongs_to :usage_point</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5239ce03b6fbbd5483726b2abbaa349e41ce26b5">
  <div class="header">
    <h3>lib/pvimpact/greenbutton/model/meter_reading.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">module PVImpactGreenButton</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # Public: This class represents Meter Reading.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  class MeterReading</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    include DataMapper::Resource</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    # Public: Returns the String id.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    property :id, Text, :key =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    # Public: Returns the UsagePoint.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    belongs_to :usage_point</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    # Public: Returns the MeterReadingType.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    has 1, :meter_reading_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # Public: Returns the IntervalBlock&#39;s.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    has n, :interval_blocks, :order =&gt; [ :start_time.asc ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="6101aa9d2d1584317189ef318d7363fd440fa26b">
  <div class="header">
    <h3>lib/pvimpact/greenbutton/model/meter_reading_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>17</b> relevant lines. 
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">module PVImpactGreenButton</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # Public: This class represents Meter Reading Type.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  class MeterReadingType</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    include DataMapper::Resource</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    # Public: Returns the String id.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    property :id, Text, :key =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    # Public: Returns the accumulation behaviour.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    property :accumulation_behaviour, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    # Public: Returns the commodity.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    property :commodity, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # Public: Returns the currency.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    property :currency, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    # Public: Returns the data qualifier.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    property :data_qualifier, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    # Public: Returns the flow direction.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    property :flow_direction, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    # Public: Returns the interval length.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    property :interval_length, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    # Public: Returns the kind.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    property :kind, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    # Public: Returns the phase.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">    property :phase, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    # Public: Returns the power of ten multiplier.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    property :power_of_ten_multiplier, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    # Public: Returns the time attribute.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">    property :time_attribute, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    # Public: Returns the UOM.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">    property :uom, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    # Public: Returns the MeterReading.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    belongs_to :meter_reading</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    # Public: Returns the aggregation type.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">    property :aggregation_type, Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b286aea2e53259713892057b5db42e1d6e64e807">
  <div class="header">
    <h3>lib/pvimpact/greenbutton/model/usage_point.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">module PVImpactGreenButton</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # Public: This class represents Usage Point.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  class UsagePoint</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    include DataMapper::Resource</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    # Public: Returns the String id.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    property :id, Text, :key =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    # Public: Returns the kind</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    property :kind, String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    # Public: Returns the subscription ID.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    property :subscription_id, Text</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # Public: Returns the MeterReading&#39;s.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    has n, :meter_readings</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    # Public: Returns the LocalTimeParameters.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    has 1, :local_time_parameters</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    # Public: Returns the ElectricityPowerUsageSummary records.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    has n, :electricity_power_usage_summaries</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="251276858dfbc288f9ba0a165c52484fdefc57ff">
  <div class="header">
    <h3>lib/pvimpact/greenbutton/parser.rb</h3>
    <h4><span class="green">90.91 %</span> covered</h4>
    <div>
      <b>44</b> relevant lines. 
      <span class="green"><b>40</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;greenbutton&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">module PVImpactGreenButton</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  # Public: Parser is used to parse GreenButton API data.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  class Parser</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    include Validation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    # Public: Returns the parsed IntervalBlock&#39;s.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_accessor :interval_blocks</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    # Public: Returns the parsed UsagePoint&#39;s.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_accessor :usage_points</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    # Private: Fill IntervalReading&#39;s to an IntervalBlock.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    # gb_interval_block - the IntervalBlock object from GreenButton gem</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    # interval_block - the IntervalBlock object from this gem</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    # Returns the IntervalBlock with readings filled</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    def fill_interval_readings(gb_interval_block, interval_block)</code>
        </li>
      
        <li class="covered" data-hits="435" data-linenumber="26">
          <span class="hits">435</span>
          
          <code class="ruby">      interval_block.interval_readings.destroy if interval_block.interval_readings &amp;&amp; !interval_block.interval_readings.empty?</code>
        </li>
      
        <li class="covered" data-hits="435" data-linenumber="27">
          <span class="hits">435</span>
          
          <code class="ruby">      gb_interval_block.doc.xpath(&quot;//entry[id=&#39;#{gb_interval_block.id}&#39;]/content/IntervalBlock/IntervalReading&quot;).each do |ir_element|</code>
        </li>
      
        <li class="covered" data-hits="12715" data-linenumber="28">
          <span class="hits">12715</span>
          
          <code class="ruby">        start_time = Time.at(ir_element.xpath(&#39;./timePeriod/start&#39;).text.to_i).utc</code>
        </li>
      
        <li class="covered" data-hits="12715" data-linenumber="29">
          <span class="hits">12715</span>
          
          <code class="ruby">        interval_block.interval_readings.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">          {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">            :aggregation_type =&gt; nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">            :cost =&gt; ir_element.xpath(&#39;./cost&#39;).text.to_f,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">            :value =&gt; ir_element.xpath(&#39;./value&#39;).text.to_f,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">            :start_time =&gt; start_time,</code>
        </li>
      
        <li class="covered" data-hits="12715" data-linenumber="35">
          <span class="hits">12715</span>
          
          <code class="ruby">            :end_time =&gt; (start_time + ir_element.xpath(&#39;./timePeriod/duration&#39;).text.to_i).utc</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">        )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="435" data-linenumber="39">
          <span class="hits">435</span>
          
          <code class="ruby">      return interval_block</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    public</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    # Public: Parse GreenButton data from given file.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    # path - The String file path of the GreenButton API data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    # subscription_id - The String ID of the subscription from which the GreenButton data is being parsed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    # Raises ArgumentError if path/subscription_id is nil or blank string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    # Raises PVImpactGreenButton::UnsupportedServiceKindError if any of the UsagePoint is for unsupported</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    # service kind (currently only 0 - electricity is supported).</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    # Raises PVImpactGreenButton::ParsingError if failed to parse the GreenButton data</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">    def parse(path, subscription_id)</code>
        </li>
      
        <li class="covered" data-hits="35" data-linenumber="54">
          <span class="hits">35</span>
          
          <code class="ruby">      validate_string(path, &#39;path&#39;)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="55">
          <span class="hits">33</span>
          
          <code class="ruby">      validate_string(subscription_id, &#39;subscription_id&#39;)</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="56">
          <span class="hits">31</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">        # Parse using GreenButton gem</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="58">
          <span class="hits">31</span>
          
          <code class="ruby">        gb = GreenButton.load_xml_from_file(path)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="60">
          <span class="hits">31</span>
          
          <code class="ruby">        @interval_blocks = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">        # Adapt GreenButton object data to local models</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="63">
          <span class="hits">31</span>
          
          <code class="ruby">        @usage_points = []</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="64">
          <span class="hits">31</span>
          
          <code class="ruby">        gb.usage_points.each do |gb_usage_point|</code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="65">
          <span class="hits">29</span>
          
          <code class="ruby">          raise PVImpactGreenButton::UnsupportedServiceKindError if gb_usage_point.service_kind != :electricity</code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="66">
          <span class="hits">29</span>
          
          <code class="ruby">          usage_point = UsagePoint.first_or_new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">            { :id =&gt; gb_usage_point.href },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">            {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">              :id =&gt; gb_usage_point.href,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">              :kind =&gt; gb_usage_point.service_kind,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">              :subscription_id =&gt; subscription_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">            }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="75">
          <span class="hits">29</span>
          
          <code class="ruby">          usage_point.local_time_parameters = LocalTimeParameters.first_or_new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">            {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">              :id =&gt; gb_usage_point.local_time_parameters.href</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">            },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">            {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">              :id =&gt; gb_usage_point.local_time_parameters.href,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">              :dst_end_rule =&gt; gb_usage_point.local_time_parameters.dst_end_rule,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">              :dst_offset =&gt; gb_usage_point.local_time_parameters.dst_offset,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">              :dst_start_rule =&gt; gb_usage_point.local_time_parameters.dst_start_rule,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">              :tz_offset =&gt; gb_usage_point.local_time_parameters.tz_offset</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">            }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="88">
          <span class="hits">29</span>
          
          <code class="ruby">          gb_usage_point.meter_readings.each do |gb_meter_reading|</code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="89">
          <span class="hits">29</span>
          
          <code class="ruby">            meter_reading = usage_point.meter_readings.first_or_new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">              {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">                :id =&gt; gb_meter_reading.href</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">              },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">              {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">                :id =&gt; gb_meter_reading.href,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">                :meter_reading_type =&gt; MeterReadingType.first_or_new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">                  {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">                    :id =&gt; gb_meter_reading.reading_type.href</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">                  },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">                  {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">                    :id =&gt; gb_meter_reading.reading_type.href,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">                    :accumulation_behaviour =&gt; gb_meter_reading.reading_type.accumulation_behaviour,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">                    :commodity =&gt; gb_meter_reading.reading_type.commodity,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">                    :currency =&gt; gb_meter_reading.reading_type.currency,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">                    :data_qualifier =&gt; gb_meter_reading.reading_type.data_qualifier,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">                    :flow_direction =&gt; gb_meter_reading.reading_type.flow_direction,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">                    :interval_length =&gt; gb_meter_reading.reading_type.interval_length,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">                    :kind =&gt; gb_meter_reading.reading_type.kind,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">                    :phase =&gt; gb_meter_reading.reading_type.phase,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">                    :power_of_ten_multiplier =&gt; gb_meter_reading.reading_type.power_of_ten_multiplier,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">                    :time_attribute =&gt; gb_meter_reading.reading_type.time_attribute,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">                    :uom =&gt; gb_meter_reading.reading_type.uom,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">                    :aggregation_type =&gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">                  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">                ),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">              }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">            )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="118">
          <span class="hits">29</span>
          
          <code class="ruby">            gb_meter_reading.interval_blocks.each do |gb_interval_block|</code>
        </li>
      
        <li class="covered" data-hits="433" data-linenumber="119">
          <span class="hits">433</span>
          
          <code class="ruby">              interval_block = meter_reading.interval_blocks.first_or_new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">                {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">                  :id =&gt; gb_interval_block.href</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">                },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">                {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">                  :id =&gt; gb_interval_block.href,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">                  :start_time =&gt; gb_interval_block.start_time,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">                  :end_time =&gt; gb_interval_block.end_time,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">                  :usage_point_id =&gt; usage_point.id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">                }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">              )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="433" data-linenumber="131">
          <span class="hits">433</span>
          
          <code class="ruby">              fill_interval_readings(gb_interval_block, interval_block)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="135">
          <span class="hits">29</span>
          
          <code class="ruby">          gb_usage_point.electric_power_usage_summaries.each do |gb_epus|</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="136">
          <span class="hits">28</span>
          
          <code class="ruby">            usage_point.electricity_power_usage_summaries.first_or_new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">            {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">                :id =&gt; gb_epus.href</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">              },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">              {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">                :id =&gt; gb_epus.href,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">                :duration =&gt; gb_epus.bill_duration,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">                :start_time =&gt; gb_epus.bill_start,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">                :bill_last_period =&gt; gb_epus.bill_last_period,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">                :bill_to_date =&gt; gb_epus.bill_to_date,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">                :cost_additional_last_period =&gt; gb_epus.cost_additional_last_period,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">                :currency =&gt; gb_epus.currency,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">                :overall_consumption_last_period_power_of_ten_multiplier =&gt; gb_epus.last_power_ten,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">                :overall_consumption_last_period_uom =&gt; gb_epus.last_uom,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">                :overall_consumption_last_period_value =&gt; gb_epus.last_value,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">                :current_billing_period_overall_consumption_power_of_ten_multiplier =&gt; gb_epus.current_power_ten,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">                :current_billing_period_overall_consumption_uom =&gt; gb_epus.current_uom,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">                :current_billing_period_overall_consumption_timestamp =&gt; gb_epus.current_timestamp,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">                :current_billing_period_overall_consumption_value =&gt; gb_epus.current_value,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">                :quality_of_reading =&gt; gb_epus.quality_of_reading,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">                :status_time_stamp =&gt; Time.at(gb_epus.status_time_stamp.to_i).utc</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">              }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">            )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="161">
          <span class="hits">29</span>
          
          <code class="ruby">          @usage_points &lt;&lt; usage_point</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="164">
          <span class="hits">31</span>
          
          <code class="ruby">        if @usage_points.empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">          # No UsagePoint&#39;s parsed</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="166">
          <span class="hits">2</span>
          
          <code class="ruby">          @interval_blocks = []</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="167">
          <span class="hits">2</span>
          
          <code class="ruby">          gb.doc.xpath(&#39;//IntervalBlock&#39;).each do |ibe|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="168">
          <span class="hits">2</span>
          
          <code class="ruby">            gb_interval_block = GreenButtonClasses::IntervalBlock.new(ibe.parent.parent, gb)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="169">
          <span class="hits">2</span>
          
          <code class="ruby">            interval_block = IntervalBlock.first_or_new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">              {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">                :id =&gt; gb_interval_block.href</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">              },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">              {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">                :id =&gt; gb_interval_block.href,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">                :start_time =&gt; gb_interval_block.start_time,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">                :end_time =&gt; gb_interval_block.end_time,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">              }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">            )</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="179">
          <span class="hits">2</span>
          
          <code class="ruby">            @interval_blocks &lt;&lt; fill_interval_readings(gb_interval_block, interval_block)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="182">
          
          
          <code class="ruby">      rescue PVImpactGreenButton::UnsupportedServiceKindError =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="183">
          
          
          <code class="ruby">        raise e</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">      rescue =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="185">
          
          
          <code class="ruby">        LOGGER.fatal(e.backtrace)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="186">
          
          
          <code class="ruby">        raise PVImpactGreenButton::ParsingError, e.message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5f9ab964bf7d09256be8cfabbbdf8b2df0b9d411">
  <div class="header">
    <h3>lib/pvimpact/greenbutton/validation.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>16</b> relevant lines. 
      <span class="green"><b>16</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">module PVImpactGreenButton</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # Public: This mixin provides utility methods to validate arguments.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  module Validation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    # Public: Validate a required argument.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    # arg - the argument</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    # arg_name - the argument name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    # Raises ArgumentError if the argument is nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate_required(arg, arg_name)</code>
        </li>
      
        <li class="covered" data-hits="191" data-linenumber="13">
          <span class="hits">191</span>
          
          <code class="ruby">      raise ArgumentError, &quot;Argument #{arg_name} should not be nil.&quot; unless arg</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    # Public: Validate a string argument.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    # arg - the argument</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    # arg_name - the argument name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # Raises ArgumentError if the argument is not a valid string (if required)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate_string(arg, arg_name, required = true)</code>
        </li>
      
        <li class="covered" data-hits="135" data-linenumber="21">
          <span class="hits">135</span>
          
          <code class="ruby">      return if !required &amp;&amp; !arg</code>
        </li>
      
        <li class="covered" data-hits="135" data-linenumber="22">
          <span class="hits">135</span>
          
          <code class="ruby">      validate_required(arg, arg_name)</code>
        </li>
      
        <li class="covered" data-hits="130" data-linenumber="23">
          <span class="hits">130</span>
          
          <code class="ruby">      raise ArgumentError, &quot;Argument #{arg_name} should be string.&quot; unless arg.respond_to?(:to_s) &amp;&amp; !(/\S/ !~ arg.to_s)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    # Public: Validate a Time argument.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    # arg - the argument</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    # arg_name - the argument name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    # required - if the argument is required</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    # Raises ArgumentError if the argument is not a valid Time (if required)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate_time(arg, arg_name, required = true)</code>
        </li>
      
        <li class="covered" data-hits="70" data-linenumber="32">
          <span class="hits">70</span>
          
          <code class="ruby">      return if !required &amp;&amp; !arg</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="33">
          <span class="hits">22</span>
          
          <code class="ruby">      validate_required(arg, arg_name)</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="34">
          <span class="hits">22</span>
          
          <code class="ruby">      raise ArgumentError, &quot;Argument #{arg_name} should be Time.&quot; unless arg.is_a? Time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    # Public: Validate a Time range.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    # arg1 - the argument 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    # arg1_name - the argument 1 name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    # arg2 - the argument 2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    # arg2_name - the argument 2 name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    # Raises ArgumentError if the time range is invalid</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate_time_range(arg1, arg1_name, arg2, arg2_name)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="44">
          <span class="hits">7</span>
          
          <code class="ruby">      raise ArgumentError, &quot;Argument #{arg1_name} should not be later than #{arg2_name}.&quot; if arg1 &amp;&amp; arg2 &amp;&amp; arg1 &gt; arg2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    # Public: Validate aggregation type.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    # arg - the argument</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    # arg_name - the argument name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    # Raises ArgumentError if the argument is not valid integer.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate_aggregation_type(arg, arg_name)</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="52">
          <span class="hits">25</span>
          
          <code class="ruby">      raise ArgumentError, &quot;Argument #{arg_name} is invalid integer.&quot; unless arg.is_a? Integer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7732073ad0e7f82830db2d9af3c795301b3a9de1">
  <div class="header">
    <h3>lib/pvimpact/greenbutton/version.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>2</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">module PVImpactGreenButton</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # This specifies the version of this gem</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  VERSION = &#39;0.0.1&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="88122358ed02c7d6f15a7dd79372ef3bdb5b470e">
  <div class="header">
    <h3>spec/pvimpact/greenbutton/aggregator_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>162</b> relevant lines. 
      <span class="green"><b>162</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"># Tests on Aggregator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">describe PVImpactGreenButton::Aggregator do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  # Setup environment.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  before do</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="10">
          <span class="hits">9</span>
          
          <code class="ruby">    @parser = PVImpactGreenButton::Parser.new()</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="11">
          <span class="hits">9</span>
          
          <code class="ruby">    @parser.parse(&#39;spec/fixtures/case_15_months_daily_interval.xml&#39;, &#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="12">
          <span class="hits">9</span>
          
          <code class="ruby">    @usage_points = @parser.usage_points</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="13">
          <span class="hits">9</span>
          
          <code class="ruby">    @usage_points.first.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  # Test on aggregate with nil usage_point</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &#39;aggregate with nil usage_point&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should fail&#39; do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="19">
          <span class="hits">2</span>
          
          <code class="ruby">      expect { PVImpactGreenButton::Aggregator.aggregate(nil, PVImpactGreenButton::AggregationType::ONE_MONTH) }.to raise_error(ArgumentError)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  # Test on aggregate with invalid aggregation_type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &#39;aggregate with invalid aggregation_type&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should fail&#39; do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="26">
          <span class="hits">2</span>
          
          <code class="ruby">      expect { PVImpactGreenButton::Aggregator.aggregate(@usage_points.first, &#39;not valid&#39;) }.to raise_error(ArgumentError)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  # Test on aggregate with nil aggregation_type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &#39;aggregate with nil aggregation_type&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should be successful&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      aggregated_usage_point = PVImpactGreenButton::Aggregator.aggregate(@usage_points.first)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.subscription_id).to eq(&#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.kind).to eq(&#39;electricity&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.id).to eq(&#39;https://services.greenbuttondata.org/DataCustodian/espi/1_1/resource/Subscription/5/UsagePoint/1&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.local_time_parameters).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.electricity_power_usage_summaries).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.length).to eq(1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.meter_reading_type).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.interval_blocks).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.interval_blocks.length).to eq(15)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">      expected_interval_reading_counts = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31, 31, 28, 20]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">      (0..14).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="48">
          <span class="hits">15</span>
          
          <code class="ruby">        expect(aggregated_usage_point.meter_readings.first.interval_blocks[i].interval_readings.length).to eq(expected_interval_reading_counts[i])</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="49">
          <span class="hits">15</span>
          
          <code class="ruby">        aggregated_usage_point.meter_readings.first.interval_blocks[i].interval_readings.each do |interval_reading|</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="50">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.value).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="51">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.cost).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="52">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.value).to be &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="53">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.cost).to be &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  # Test on aggregate with ONE_HOUR aggregation_type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &#39;aggregate with ONE_HOUR aggregation_type&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should be successful&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">      aggregated_usage_point = PVImpactGreenButton::Aggregator.aggregate(@usage_points.first, PVImpactGreenButton::AggregationType::ONE_DAY)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.subscription_id).to eq(&#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.kind).to eq(&#39;electricity&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.id).to eq(&#39;https://services.greenbuttondata.org/DataCustodian/espi/1_1/resource/Subscription/5/UsagePoint/1&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.local_time_parameters).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.electricity_power_usage_summaries).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.length).to eq(1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.meter_reading_type).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.interval_blocks).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.interval_blocks.length).to eq(15)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">      expected_interval_reading_counts = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31, 31, 28, 20]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">      (0..14).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="77">
          <span class="hits">15</span>
          
          <code class="ruby">        expect(aggregated_usage_point.meter_readings.first.interval_blocks[i].interval_readings.length).to eq(expected_interval_reading_counts[i])</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="78">
          <span class="hits">15</span>
          
          <code class="ruby">        aggregated_usage_point.meter_readings.first.interval_blocks[i].interval_readings.each do |interval_reading|</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="79">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.value).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="80">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.cost).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="81">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.value).to be &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="82">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.cost).to be &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  # Test on aggregate with DEFAULT aggregation_type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &#39;aggregate with DEFAULT&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should be successful&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">      aggregated_usage_point = PVImpactGreenButton::Aggregator.aggregate(@usage_points.first, PVImpactGreenButton::AggregationType::DEFAULT)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.subscription_id).to eq(&#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.kind).to eq(&#39;electricity&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.id).to eq(&#39;https://services.greenbuttondata.org/DataCustodian/espi/1_1/resource/Subscription/5/UsagePoint/1&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.local_time_parameters).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.electricity_power_usage_summaries).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.length).to eq(1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.meter_reading_type).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.interval_blocks).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.interval_blocks.length).to eq(15)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">      expected_interval_reading_counts = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31, 31, 28, 20]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">      (0..14).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="106">
          <span class="hits">15</span>
          
          <code class="ruby">        expect(aggregated_usage_point.meter_readings.first.interval_blocks[i].interval_readings.length).to eq(expected_interval_reading_counts[i])</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="107">
          <span class="hits">15</span>
          
          <code class="ruby">        aggregated_usage_point.meter_readings.first.interval_blocks[i].interval_readings.each do |interval_reading|</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="108">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.value).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="109">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.cost).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="110">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.value).to be &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="111">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.cost).to be &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">  # Test on aggregate with ONE_DAY aggregation_type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &#39;aggregate with ONE_DAY aggregation_type&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should be successful&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">      aggregated_usage_point = PVImpactGreenButton::Aggregator.aggregate(@usage_points.first, PVImpactGreenButton::AggregationType::DEFAULT)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.subscription_id).to eq(&#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.kind).to eq(&#39;electricity&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.id).to eq(&#39;https://services.greenbuttondata.org/DataCustodian/espi/1_1/resource/Subscription/5/UsagePoint/1&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.local_time_parameters).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.electricity_power_usage_summaries).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.length).to eq(1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.meter_reading_type).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.interval_blocks).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.interval_blocks.length).to eq(15)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">      expected_interval_reading_counts = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31, 31, 28, 20]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">      (0..14).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="136">
          <span class="hits">15</span>
          
          <code class="ruby">        expect(aggregated_usage_point.meter_readings.first.interval_blocks[i].interval_readings.length).to eq(expected_interval_reading_counts[i])</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="137">
          <span class="hits">15</span>
          
          <code class="ruby">        aggregated_usage_point.meter_readings.first.interval_blocks[i].interval_readings.each do |interval_reading|</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="138">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.value).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="139">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.cost).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="140">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.value).to be &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="141">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.cost).to be &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">  # Test on aggregate with ONE_MONTH aggregation_type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &#39;aggregate with ONE_MONTH aggregation_type&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should be successful&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">      aggregated_usage_point = PVImpactGreenButton::Aggregator.aggregate(@usage_points.first, PVImpactGreenButton::AggregationType::ONE_MONTH)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.subscription_id).to eq(&#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.kind).to eq(&#39;electricity&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.id).to eq(&#39;https://services.greenbuttondata.org/DataCustodian/espi/1_1/resource/Subscription/5/UsagePoint/1&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="156">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.local_time_parameters).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.electricity_power_usage_summaries).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="158">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.length).to eq(1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.meter_reading_type).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.interval_blocks).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.interval_blocks.length).to eq(15)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">      (0..14).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="165">
          <span class="hits">15</span>
          
          <code class="ruby">        expect(aggregated_usage_point.meter_readings.first.interval_blocks[i].interval_readings.length).to eq(1)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="166">
          <span class="hits">15</span>
          
          <code class="ruby">        aggregated_usage_point.meter_readings.first.interval_blocks[i].interval_readings.each do |interval_reading|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="167">
          <span class="hits">15</span>
          
          <code class="ruby">          expect(interval_reading.value).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="168">
          <span class="hits">15</span>
          
          <code class="ruby">          expect(interval_reading.cost).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="169">
          <span class="hits">15</span>
          
          <code class="ruby">          expect(interval_reading.value).to be &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="170">
          <span class="hits">15</span>
          
          <code class="ruby">          expect(interval_reading.cost).to be &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">  # Test on aggregate with FIFTEEN_MINUTES aggregation_type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &#39;aggregate with FIFTEEN_MINUTES aggregation_type&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should be successful&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">      aggregated_usage_point = PVImpactGreenButton::Aggregator.aggregate(@usage_points.first, PVImpactGreenButton::AggregationType::FIFTEEN_MINUTES)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.subscription_id).to eq(&#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.kind).to eq(&#39;electricity&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.id).to eq(&#39;https://services.greenbuttondata.org/DataCustodian/espi/1_1/resource/Subscription/5/UsagePoint/1&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.local_time_parameters).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.electricity_power_usage_summaries).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="186">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="187">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.length).to eq(1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.meter_reading_type).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.interval_blocks).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.interval_blocks.length).to eq(15)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">      expected_interval_reading_counts = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31, 31, 28, 20]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">      (0..14).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="194">
          <span class="hits">15</span>
          
          <code class="ruby">        expect(aggregated_usage_point.meter_readings.first.interval_blocks[i].interval_readings.length).to eq(4 * 24 * expected_interval_reading_counts[i])</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="195">
          <span class="hits">15</span>
          
          <code class="ruby">        aggregated_usage_point.meter_readings.first.interval_blocks[i].interval_readings.each do |interval_reading|</code>
        </li>
      
        <li class="covered" data-hits="42624" data-linenumber="196">
          <span class="hits">42624</span>
          
          <code class="ruby">          expect(interval_reading.value).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="42624" data-linenumber="197">
          <span class="hits">42624</span>
          
          <code class="ruby">          expect(interval_reading.cost).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="42624" data-linenumber="198">
          <span class="hits">42624</span>
          
          <code class="ruby">          expect(interval_reading.value).to be &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="42624" data-linenumber="199">
          <span class="hits">42624</span>
          
          <code class="ruby">          expect(interval_reading.cost).to be &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">  # Test on aggregate with FIFTEEN_MINUTES aggregation_type for accuracy verification</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &#39;aggregate with FIFTEEN_MINUTES aggregation_type accuracy verification&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should be successful&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">      @parser.parse(&#39;spec/fixtures/case_1_day_daily_interval.xml&#39;, &#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">      usage_point = @parser.usage_points.first</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="210">
          <span class="hits">1</span>
          
          <code class="ruby">      aggregated_usage_point = PVImpactGreenButton::Aggregator.aggregate(usage_point, PVImpactGreenButton::AggregationType::FIFTEEN_MINUTES)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.subscription_id).to eq(&#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.kind).to eq(&#39;electricity&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.id).to eq(&#39;https://services.greenbuttondata.org/DataCustodian/espi/1_1/resource/RetailCustomer/1/UsagePoint/1&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.local_time_parameters).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="216">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.electricity_power_usage_summaries).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="217">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="218">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.length).to eq(1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.meter_reading_type).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="220">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.interval_blocks).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.interval_blocks.length).to eq(1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="223">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(aggregated_usage_point.meter_readings.first.interval_blocks[0].interval_readings.length).to eq(4 * 24)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">      expected_costs = [646.25, 646.25, 646.25, 646.25, 184.5, 184.5, 184.5, 184.5, 213.5, 213.5,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">                        213.5, 213.5, 211.25, 211.25, 211.25, 211.25, 197.0, 197.0, 197.0, 197.0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby">                        217.75, 217.75, 217.75, 217.75, 566.0, 566.0, 566.0, 566.0, 1953.5, 1953.5,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">                        1953.5, 1953.5, 2005.75, 2005.75, 2005.75, 2005.75, 1890.5, 1890.5, 1890.5,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">                        1890.5, 2189.25, 2189.25, 2189.25, 2189.25, 2022.25, 2022.25, 2022.25,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby">                        2022.25, 1844.25, 1844.25, 1844.25, 1844.25, 1932.75, 1932.75, 1932.75, 1932.75,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">                        1851.75, 1851.75, 1851.75, 1851.75, 3195.5, 3195.5, 3195.5, 3195.5, 3760.50,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">                        3760.50, 3760.50, 3760.50, 5190.25, 5190.25, 5190.25, 5190.25, 5001.25, 5001.25,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">                        5001.25, 5001.25, 5247.0, 5247.0, 5247.0, 5247.0, 8246.25, 8246.25, 8246.25, 8246.25,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">                        6582.25, 6582.25, 6582.25, 6582.25, 4440.5, 4440.5, 4440.5, 4440.5, 1121.25, 1121.25, 1121.25, 1121.25]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">      expected_values = [215.25, 215.25, 215.25, 215.25, 61.5, 61.5, 61.5,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">                         61.5, 71.0, 71.0, 71.0, 71.0, 70.25, 70.25, 70.25, 70.25, 65.5, 65.5, 65.5,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">                         65.5, 72.5, 72.5, 72.5, 72.5, 188.5, 188.5, 188.5, 188.5, 325.5, 325.5, 325.5, 325.5,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">                         334.25, 334.25, 334.25, 334.25, 315.0, 315.0, 315.0, 315.0, 364.75, 364.75, 364.75, 364.75,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">                         337.0, 337.0, 337.0, 337.0, 307.25, 307.25, 307.25, 307.25, 322.0, 322.0, 322.0, 322.0, 308.5,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">                         308.5, 308.5, 308.5, 355.0, 355.0, 355.0, 355.0, 313.25, 313.25, 313.25, 313.25, 346.0, 346.0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">                         346.0, 346.0, 333.25, 333.25, 333.25, 333.25, 349.75, 349.75, 349.75, 349.75, 343.5, 343.5,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">                         343.5, 343.5, 365.5, 365.5, 365.5, 365.5, 370.0, 370.0, 370.0, 370.0, 186.75, 186.75, 186.75, 186.75]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">      (0..23).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="245">
          <span class="hits">24</span>
          
          <code class="ruby">        interval_reading = aggregated_usage_point.meter_readings.first.interval_blocks[0].interval_readings[i]</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="246">
          <span class="hits">24</span>
          
          <code class="ruby">        expect(interval_reading.value).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="247">
          <span class="hits">24</span>
          
          <code class="ruby">        expect(interval_reading.cost).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="248">
          <span class="hits">24</span>
          
          <code class="ruby">        expect(interval_reading.value).to be_within(0.01).of(expected_values[i])</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="249">
          <span class="hits">24</span>
          
          <code class="ruby">        expect(interval_reading.cost).to be_within(0.01).of(expected_costs[i])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="253">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="19eb1ceffa89831d57b0e0880f0501e4a2a32d26">
  <div class="header">
    <h3>spec/pvimpact/greenbutton/parser_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>92</b> relevant lines. 
      <span class="green"><b>92</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Copyright (c) 2015, TopCoder Inc., All Rights Reserved.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Author: albertwang</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Version: 1.0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"># Tests on Parser.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">describe PVImpactGreenButton::Parser do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  # Create parser before running test case.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  before do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="10">
          <span class="hits">8</span>
          
          <code class="ruby">    @parser = PVImpactGreenButton::Parser.new()</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  # Tests on parse to parse XML with 15 months daily interval data</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &quot;parse - &#39;15 months daily interval&#39;&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should be successful&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">      @parser.parse(&#39;spec/fixtures/case_15_months_daily_interval.xml&#39;, &#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">      usage_points = @parser.usage_points</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.length).to eq(1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.subscription_id).to eq(&#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.kind).to eq(&#39;electricity&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.id).to eq(&#39;https://services.greenbuttondata.org/DataCustodian/espi/1_1/resource/Subscription/5/UsagePoint/1&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.local_time_parameters).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.electricity_power_usage_summaries).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.meter_readings).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.meter_readings.length).to eq(1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.meter_readings.first.meter_reading_type).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.meter_readings.first.interval_blocks).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.meter_readings.first.interval_blocks.length).to eq(15)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">      expected_interval_reading_counts = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31, 31, 28, 20]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      (0..14).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="34">
          <span class="hits">15</span>
          
          <code class="ruby">        expect(usage_points.first.meter_readings.first.interval_blocks[i].interval_readings.length).to eq(expected_interval_reading_counts[i])</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="35">
          <span class="hits">15</span>
          
          <code class="ruby">        usage_points.first.meter_readings.first.interval_blocks[i].interval_readings.each do |interval_reading|</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="36">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.value).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="37">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.cost).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="38">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.value).to be &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="39">
          <span class="hits">444</span>
          
          <code class="ruby">          expect(interval_reading.cost).to be &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  # Tests on parse to parse XML with 12 months daily interval data</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &quot;parse - &#39;12 months daily interval&#39;&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should be successful&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">      @parser.parse(&#39;spec/fixtures/case_12_months_daily_interval.xml&#39;, &#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">      usage_points = @parser.usage_points</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.length).to eq(1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.subscription_id).to eq(&#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.kind).to eq(&#39;electricity&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.id).to eq(&#39;https://services.greenbuttondata.org/DataCustodian/espi/1_1/resource/Subscription/5/UsagePoint/1&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.local_time_parameters).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.electricity_power_usage_summaries).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.meter_readings).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.meter_readings.length).to eq(1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.meter_readings.first.meter_reading_type).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.meter_readings.first.interval_blocks).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.meter_readings.first.interval_blocks.length).to eq(12)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">      expected_interval_reading_counts = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">      (0..11).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="66">
          <span class="hits">12</span>
          
          <code class="ruby">        expect(usage_points.first.meter_readings.first.interval_blocks[i].interval_readings.length).to eq(expected_interval_reading_counts[i])</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="67">
          <span class="hits">12</span>
          
          <code class="ruby">        usage_points.first.meter_readings.first.interval_blocks[i].interval_readings.each do |interval_reading|</code>
        </li>
      
        <li class="covered" data-hits="365" data-linenumber="68">
          <span class="hits">365</span>
          
          <code class="ruby">          expect(interval_reading.value).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="365" data-linenumber="69">
          <span class="hits">365</span>
          
          <code class="ruby">          expect(interval_reading.cost).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="365" data-linenumber="70">
          <span class="hits">365</span>
          
          <code class="ruby">          expect(interval_reading.value).to be &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="365" data-linenumber="71">
          <span class="hits">365</span>
          
          <code class="ruby">          expect(interval_reading.cost).to be &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  # Tests on parse to parse XML with 1 month daily interval data</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &quot;parse - &#39;1 month daily interval&#39;&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should be successful&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">      @parser.parse(&#39;spec/fixtures/case_1_month_daily_interval.xml&#39;, &#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">      usage_points = @parser.usage_points</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.length).to eq(1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.subscription_id).to eq(&#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.kind).to eq(&#39;electricity&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.id).to eq(&#39;https://services.greenbuttondata.org/DataCustodian/espi/1_1/resource/RetailCustomer/1/UsagePoint/1&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.local_time_parameters).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.electricity_power_usage_summaries).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.meter_readings).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.meter_readings.length).to eq(1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.meter_readings.first.meter_reading_type).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.meter_readings.first.interval_blocks).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(usage_points.first.meter_readings.first.interval_blocks.length).to eq(30)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">      # expected_interval_reading_counts = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31, 31, 28, 20]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">      (0..29).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="98">
          <span class="hits">30</span>
          
          <code class="ruby">        expect(usage_points.first.meter_readings.first.interval_blocks[i].interval_readings.length).to eq(24)</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="99">
          <span class="hits">30</span>
          
          <code class="ruby">        usage_points.first.meter_readings.first.interval_blocks[i].interval_readings.each do |interval_reading|</code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="100">
          <span class="hits">720</span>
          
          <code class="ruby">          expect(interval_reading.value).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="101">
          <span class="hits">720</span>
          
          <code class="ruby">          expect(interval_reading.cost).not_to eq(nil)</code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="102">
          <span class="hits">720</span>
          
          <code class="ruby">          expect(interval_reading.value).to be &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="720" data-linenumber="103">
          <span class="hits">720</span>
          
          <code class="ruby">          expect(interval_reading.cost).to be &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">  # Tests on parse to parse XML without usage points data</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &quot;parse - &#39;without usage points&#39;&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should be successful&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">      @parser.parse(&#39;spec/fixtures/case_without_usage_point.xml&#39;, &#39;test&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(@parser.interval_blocks.length).to eq(1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(@parser.usage_points.empty?).to eq(true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">  # Tests on parse with nil path</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &quot;parse - nil path&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should fail&#39; do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="121">
          <span class="hits">2</span>
          
          <code class="ruby">      expect{ @parser.parse(nil, &#39;test&#39;) }.to raise_error(ArgumentError)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">  # Tests on parse with blank path</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &quot;parse - blank path&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should fail&#39; do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="128">
          <span class="hits">2</span>
          
          <code class="ruby">      expect{ @parser.parse(&#39; &#39;, &#39;test&#39;) }.to raise_error(ArgumentError)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">  # Tests on parse with nil subscription_id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &quot;parse - nil subscription_id&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should fail&#39; do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="135">
          <span class="hits">2</span>
          
          <code class="ruby">      expect{ @parser.parse(&#39;spec/fixtures/case_without_usage_point.xml&#39;, nil) }.to raise_error(ArgumentError)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">  # Tests on parse with blank subscription_id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">  describe &quot;parse - blank subscription_id&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;should fail&#39; do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="142">
          <span class="hits">2</span>
          
          <code class="ruby">      expect{ @parser.parse(&#39;spec/fixtures/case_without_usage_point.xml&#39;, &#39;&#39;) }.to raise_error(ArgumentError)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
      </div>
    </div>
  </body>
</html>
